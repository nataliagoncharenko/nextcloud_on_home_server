# Установка Nextcloud на домащний Ubuntu Server на Dexp Compact M008

Устанавливаем Nextcloud через Docker контейнер

Создание папки для данных и запуск контейнера:

mkdir -p ~/nextcloud/data ~/nextcloud/db

Запуск Nextcloud с базой данных MariaDB через docker-compose.yml:

переходим в редактор nano:

nano ~/nextcloud/docker-compose.yml

yaml файл:

version: '3'
services:
  db:
    image: mariadb:10.6
    restart: always
    volumes:
      - ~/nextcloud/db:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=пароль_для_root
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
      - MYSQL_PASSWORD=пароль_для_nextcloud

  app:
    image: nextcloud:latest
    restart: always
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ~/nextcloud/data:/var/www/html
    depends_on:
      - db
    environment:
      - MYSQL_HOST=db
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
      - MYSQL_PASSWORD=пароль_для_nextcloud

Разберем yaml файл - это конфигурационный файл для Docker Compose, он является инструментом, который позволяет запускать несколько контейнеров сразу (базу данных и веб-приложение), связывать их между собой, настраивать тома, порты и переменные окружения. Этот файл запускает Nextcloud с базой данных MariaDB.
В качестве базы данных используется база данных MariaDB, т.к. она является бесплатным и безопасным вариантом:open-source, разрабатывается сообществом, она рекомендована экосистемой open-source (прямо указывается в документации о поддержке MariaDB), она является потомком MySQL, что означает совместимость на 99%, у нее есть улучшения "из коробки" (быстрые временные таблицы, больше движков хранения, улучшенная оптимизация запросов, встроенные параллельные запросы), поддержка в Docker (официальный образ mariadb в Docker Hub поддерживается разработчиками), активное развитие. 

В синтаксисе основным являются отступы, основными блоками являются разделы и все, что внутри раздела отделено отступами, является частью раздела, принцип вложенности. 

В указанном файле 2 раздела: 

1) version: '3'
Указывает версию синтаксиса Docker Compose, в данном случае - версия 3, является совремнной версией, которая поддерживает большинство фич. Является шапкой и указывает Docker как читать файл. 

2) services
В этом разделе указываются все контейнеры, которые нужно запустить. По отступам мы видим, что контейнеров 2: db (база-данных) app (веб-приложение Nextcloud). 

База данных и приложение живут в отдельных контейнеров, внутри них являются независимыми и "думают", что они одни. 

Рассмотрим, что происходит в сервисе базы данных - db. содержит в себе (смотрим на первый отступ): образ, перезапуск, тома (volumes), окружение. 






Задруживает контейнеры Docker Compose - без прямого участия разработчика он создает сеть благодаря тому, что указано в файле 

Запускаем Nextcloud:

cd ~/nextcloud
docker compose up -d

Базово был запущен указанный файл, но т.к. мой Dexp не мщное железо, то можно ускорить работу Nextcloud c помощью кэширования Redis. 
Добавим это в файл yaml. 